# so that ./manage.sh attach {machinename} works: container_name == prefix + service-name
version: '2'
volumes:
  mailstorage:

services:

  # public mail server can receive mails
  mail:
    container_name: ${DCPREFIX}_mail
    build: ../machines/mail
    volumes:
      - mailstorage:/home/postmaster/Maildir
    ports:
      - "${SMTP_PORT}:25"

  roundcube:
    build: ../machines/roundcube
    container_name: ${DCPREFIX}_roundcube
    ports:
      - "${ROUNDCUBE_PORT}:80"
    environment:
      MAIL_SERVER: mail

  # internal mail server to check outgoing odoo mails
  roundcube_check_sent_mails:
    build: ../machines/roundcube
    container_name: ${DCPREFIX}_roundcube_check_sent_mails
    ports:
      - "${ROUNDCUBE_CHECK_SENT_MAILS_PORT}:80"
    environment:
      MAIL_SERVER: mail_check_sent_mails

  mail:
    container_name: ${DCPREFIX}_mail
    build: ../machines/mail
    volumes:
      - ../data/mail/odoo_sent_mails:/home/postmaster/Maildir
