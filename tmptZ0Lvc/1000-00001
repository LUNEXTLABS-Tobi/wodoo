networks:
  default:
    external:
      name: home_marc_odoo_default
services:
  odoo:
    build: &id001
      args:
        ODOO_VERSION: 8.0
      context: $ODOO_HOME/machines/odoo
    cap_add: &id002
    - SYS_ADMIN
    - NET_ADMIN
    - DAC_READ_SEARCH
    command: /rootrun.sh
    container_name: caetec11_odoo
    env_file: &id003
    - $ODOO_HOME/run/settings
    - $ODOO_HOME/machines/odoo/docker-env
    environment:
      DEBUGGER_ODOO_PID: /tmp/odoo.debug.pid
      DEBUGGER_WATCH: /tmp/debug/odoo_debug.txt
    logging: &id004
      options:
        max-size: 1g
    security_opt: &id005
    - apparmor:unconfined
    - seccomp:unconfined
    volumes: &id006
    - /home/marc/odoo/dumps:/opt/dumps
    - /opt/oefiles/:/opt/files
    - /home/marc/odoo/admin:/opt/odoo/admin
    - /home/marc/odoo/data/src/customs/caetec11:/opt/odoo/active_customs
    - /home/marc/odoo/data/src/customs/caetec11/links:/opt/odoo/addons_customs
    - /home/marc/odoo/run/debug:/tmp/debug
    - /home/marc/odoo/machines/odoo/bin/update_modules.py:/update_modules.py
  odoo_base:
    build: *id001
    cap_add: *id002
    command: echo 'odoo_base - good bye - it is ok!'
    container_name: caetec11_odoo_base
    env_file: *id003
    logging: *id004
    security_opt: *id005
    volumes: *id006
  odoo_cronjobs:
    build: *id001
    cap_add: *id002
    command: /rootrun.sh
    container_name: caetec11_odoo_cronjobs
    env_file: *id003
    environment:
      IS_ODOO_CRONJOB: 1
    logging:
      options:
        max-size: 3g
    security_opt: *id005
    volumes: *id006
  odoo_debug:
    build: *id001
    cap_add: *id002
    command: /rootrun.sh
    container_name: caetec11_odoo_debug
    env_file: *id003
    environment:
      DEBUGGER_ODOO_PID: /tmp/odoo.debug.pid
      DEBUGGER_WATCH: /tmp/debug/odoo_debug.txt
      ENDLESS_LOOP: 1
    logging: *id004
    security_opt: *id005
    volumes: *id006
  odoo_source_syncer:
    build: *id001
    cap_add: *id002
    command: rsync --daemon --no-detach
    container_name: caetec11_odoo_source_syncer
    env_file: *id003
    logging: *id004
    security_opt: *id005
    volumes: *id006
  odoo_update:
    build: *id001
    cap_add: *id002
    command: echo 'good bye - it is ok!'
    container_name: caetec11_odoo_updater
    env_file: *id003
    logging: *id004
    security_opt: *id005
    volumes: *id006
version: '3.5'

